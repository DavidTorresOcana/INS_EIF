# INS_EIF
Extended Information Filter for Inertial Navigation: UAV Attitude determination with multisensor/multirate systems

## Synopsis
Matlab development and Autogenerated code for an Inertial navigation system using Extended Information Filter for multi IMU/GPS and multi sampling rates architecture..


## Requirements

* Requires Matlab 2015a or above


## Installation

## Usage
See *examples/IKARUS autopilot/main.c* for reference.
### Declarations and initialization 
* Add libraries
```
#include "EIF_n_dof.h"
#include "EIF_init.h" 
```
* Initialize filter variables:
```
 //EIF  variables
float ypr_eif[2];	
real_T eul[3] ={0,0,0};
int32_T number_sensors = 2; // Number of sensor being used
char_T sensors[8] ={ 'g', 'y', 'r', 'o' , 'a', 'c', 'c', 'e' };// Add here which ever number and type of sensors

real_T X[7],X_out[7];
real_T P[49],P_out[49];
real_T Q[36];
real_T sigmas[2];

real_T AT;// loop delta time
real_T measures[6];
 ```
 * Initialize EIF:
 ```
 EIF_init( eul, X, P, Q,sigmas);
 ```
 Notes: See *EIF_init/EIF_init.c* for initialization tuning
 ### Main loop at AT rate:
 * Compute AT in seconds: Elapsed delta time since last execution. See RTOS funtionalities for loop rate time
 * Execute filter:
 ```
EIF_n_dof( (const real_T*) X,(const real_T*) P,(const real_T*)Q,(const real_T*) sigmas,(const real_T*) measures , (const real_T) AT,  eul,X_out, P_out);	   // AT has to be defined correctly!!!!

// Update X and P
memcpy(X,X_out,7*sizeof(real_T));
memcpy(P,P_out,49*sizeof(real_T));	
  
ypr_eif[0] = eul[1]*(180.0/PI);	 // Pitch in degs
ypr_eif[1] = eul[0]*(180.0/PI);	 // Roll in degs
eul[2]*(180.0/PI);                // Yaw/heading in degs.

//EIF angles
pitch = ypr_eif[0];
roll = ypr_eif[1];
 ```

## Tests and Demo Video
[![INF with EIF](https://photos-1.dropbox.com/t/2/AADJESYJjzcmC0Obysz4uTGkHSz3xhVc0rDT0AsVOEJK0w/12/16640430/jpeg/32x32/1/_/1/2/MOV_1099.mp4/EO-ktAwY6awEIAIoAg/qwtweRtsvMHZcCMK8UeSLIohIybhuZ7BkiqCldPhybQ%2CrEcQ9VEalg1zr6HXyl-Z3lxaQjEyxgEjw4qp9kGvYj4%2CmZhyZ8Ksa7lBtANhB6jmAi0jnGWej4_LGcQAj0W2UrU%2CMhzwtn4IIEULsPzEg5v_pOHPrqtqvAPFvEKseS-BI5M%2CBx3TZEurXM1EzXpg-yPntl1_Wrk0HyhIqIk_mWGcpOY%2CmK8BbqNRIW7xFpau4A9kCOgADVnBGyPK0vcKmLLz7aM%2C2uuhi-IhJwRABbhKWZ9iMyxLGWHIvtAufZq3gNo81r0%2CLbEyF_bBqY_1RM_mptAhfDBLfnB-yyFAxo6pOrQkeEA%2CGQjs7UqIu38RYRfBRwUwQpmEm-mF6jPERznR7rYP5ro%2CLzade8YCBbCiNrqiRhajGTwKEqeKghj4fhYiUXD_d2k%2Cjzkg0Fy00s0BFY-7WpScokYaP3qyspfgbKDoIZAqRaU%2C8WD5JUp_SFpH9XDJiWYIS1fhKXpZRUzwRGJFDE8968A?size=32x32&size_mode=1)](https://www.dropbox.com/s/rxmxjgcjtwu1rox/MOV_1099.mp4?dl=0)

## Contributors

@David Torres Oca√±a
    david.torres.ocana@gmail.com
